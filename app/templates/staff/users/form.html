{% extends "../base.html" %}
{% load i18n %}

{% block sidebar %}
{% with page=1 %}
{{ block.super }}
{% endwith %}
{% endblock %}

{% block content %}
<div class="content p-3">
  <div class="card shadow mb-4">
    <div class="card-header py-3">
      <h6 class="m-0 font-weight-bold text-primary">{% trans "user.details" %}</h6>
    </div>
    <div class="card-body">
      <form id="fmt" method="POST" novalidate> 
        {% csrf_token %}        
        <table class="table table-form mb-2">
          {% if edit_user %}
            <tr>
              <th>{% trans "fullname" %}:</th>
              <td>{{ edit_user.fullname }}</td>              
            </tr>
            <tr>
              <th>{% trans "email.address" %}:</th>
              <td>{{edit_user.email}}</td>              
            </tr>         
          {%endif%}
          {{ form }}
        </table>
        <a class="btn btn-sm btn-secondary mr-1" href='/staff/users'>
          <i class="fas fa-arrow-left text-white-50"></i> {% trans "back" %}
        </a>
        <button class="btn btn-sm btn-primary" id="btn_save" onclick="save()" type="button">
          <i class="fas fa-save text-white-50"></i> {% trans "save" %}
        </button>        
      </form>
    </div>
  </div>
</div>
<script>
  async function save() {
    var resp = await fetch('/api/get_admin_role_id');
    var result = await resp.json();
    var adminRoleId = result.adminRoleId;
    var roleIds = $('#id_roles').val();
    var containRoleAdmin = roleIds.find(x => x == adminRoleId);

    if('{{lockAdmin}}' === 'True') {
      if(!containRoleAdmin) {
        alert('{% trans "cannot.remove.role.admin" %}');
        return;
      }
    }

    if('{{edit_user.is_tenant_admin}}' == 'False' && containRoleAdmin) {
      alert('{% trans "role.admin.warning" %}')
    }

    $('#fmt').submit();
  }
</script>
{% endblock %}