{% extends "./base.html" %}

{% block content %}
<div class="content">
  <ul class="nav nav-tabs">
    <li class="nav-item">
      <a href="/staff" class="nav-link">Table view</a>
    </li>
    <li class="nav-item">
      <a href="/staff/map_view" class="nav-link active">Map view</a>
    </li>
  </ul>
  <div>
    <div id="map" style="width: 100%; height: 500px;"></div>
  </div>
</div>

<script>
  var map;
  async function initMap() {
    var response = await fetch('/api/checkin/search?start=0&length=10');
    var result = await response.json();
    var items = result.data;

    console.log(items);

    var position = { lat: 52.479865, lng: -1.911067 };
    map = new google.maps.Map(document.getElementById('map'), { zoom: 16, center: position });
    items.forEach(item => 
        new google.maps.Marker({ 
          position: item.geoLocation, map: map, 
          label: { text: `${item.user} (${item.datediff} ago)`, color: '#222' } 
        })
    );
  }
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBR8gU4Te36NCYlc2ZdynsOWQOS03lzWKc&callback=initMap"></script>
{% endblock %}