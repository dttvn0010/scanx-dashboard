{% extends "../base.html" %}

{% block sidebar %}
{% with page=4 %}
{{ block.super }}
{% endwith %}
{% endblock %}


{% block content %}
<div class="content">
  <ul class="nav nav-tabs mb-4">
    <li class="nav-item">
      <a href="/staff/report/check_in" class="nav-link active">Check In</a>
    </li>
    <li class="nav-item">
      <a href="/staff/report/log_in" class="nav-link">Log In</a>
    </li>
  </ul>
  <div class="pr-3 pl-3 pt-2 pb-2">
    <form>
      <input type="hidden" name="reported" value="1">
      <div class="row">
        <div class="col">
          <label><b>Show Scan by:</b></label>
        </div>
      </div>    
      <div class="row mt-2">
        <div class="col-3">
          <label>User:</label>
          <select name="userId" class="form-control">
            <option value="">All User</option>
            {% for u in users %}
              <option value="{{u.id}}" {% if userId|add:0 == u.id %}selected{%endif%}>{{u.fullname}}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-3">
          <label>Location:</label>
          <select name="locationId" class="form-control">
            <option value="">All Location</option>
            {% for l in locations %}
              <option value="{{l.id}}" {% if locationId|add:0 == l.id %}selected{%endif%}>{{l.addressLine1}}, {{l.addressLine2}}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-3">
          <label>From date:</label>
          <input name="startDate" value="{{startDate|default:''}}" class="form-control date" placeholder="Select a date">
        </div>
        <div class="col-3">
          <label>To date:</label>
          <input name="endDate" value="{{endDate|default:''}}" class="form-control date" placeholder="Select a date">
        </div>
      </div>
      <div class="row mt-3">
        <div class="col">
          <button type="submit" class="btn btn-primary">Report</button>
        </div>
      </div>
    </form>

    <table style="display: none;" id="table" class="display">
      <thead>
        <tr>
          <th style="width: 40%;">Location</th>
          <th style="width: 40%;">Date/Time</th>
          <th style="width: 20%;">User</th>
        </tr>
      </thead>     
    </table>
  </div>
</div>
<script>
  $(document).ready(function() {
    $('.date').datetimepicker({format: 'DD/MM/yyyy'});
    if('{{reported}}' != '') {     
      $('#table').show();   
      $('#table').DataTable({
        "ordering": false,
        "searching": false,
        "processing": true,
        "serverSide": true,
        "ajax":{
          "url": "/api/checkin/search",
          "data": function(data) {
            data.userId = '{{userId}}';
            data.locationId = '{{locationId}}';
            data.startDate = '{{startDate}}';
            data.endDate = '{{endDate}}';
          }
        },
        "columns": [
          { "data": "location" },
          { "data": "date" },
          { "data": "user" }
        ],
        dom: 'Bfrtip',
        buttons: [
            'csv', 'excel', 'pdf'
        ]
      });
    }
  });
  </script>
{% endblock %}